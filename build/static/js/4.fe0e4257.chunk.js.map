{"version":3,"sources":["services/auth/auth.js","axios-config.js","components/user/logout/logout.jsx","components/basic/header/header.jsx","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","components/modal/modal.jsx","components/countries/country/country.jsx","services/countries/countries.js","components/countries/countries/countries.jsx","pages/home-page/home-page.jsx"],"names":["saveTokens","accessToken","refreshToken","expires","localStorage","setItem","JSON","stringify","register","userData","a","axios","method","url","data","lastName","firstName","patronymic","userName","password","confirmPassword","phoneNumber","email","response","login","logout","removeItem","token","parse","getItem","axiosConfig","create","baseURL","Logout","className","onClick","Header","user","_arrayLikeToArray","arr","len","length","i","arr2","Array","_slicedToArray","isArray","Symbol","iterator","Object","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","value","err","o","minLen","n","prototype","toString","call","slice","constructor","name","from","test","TypeError","Modal","isOpened","toggleModal","children","e","stopPropagation","Country","countryData","useState","isModalOpened","currency","currencyCode","shortName","getCountriesFromApi","headers","Countries","countries","setCountries","redirect","setRedirect","loading","setLoadingStatus","error","setError","useEffect","clean","status","getCountries","map","country","id","to","HomePage"],"mappings":"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","file":"static/js/4.fe0e4257.chunk.js","sourcesContent":["import axios from '../../axios-config.js'\n\nfunction saveTokens(accessToken, refreshToken, expires) {\n    localStorage.setItem('user', JSON.stringify({\n        'accessToken': accessToken, \n        'refreshToken': refreshToken,\n        'expires': expires\n    }));\n}\n\nexport async function register(userData) {\n    try {\n        const response = await axios({\n            method: 'post',\n            url: '/Auth/register',\n            data: {\n                lastName: userData.lastName,\n                firstName: userData.firstName,\n                patronymic: userData.patronymic,\n                userName: userData.userName,\n                password: userData.password,\n                confirmPassword: userData.confirmPassword,\n                phoneNumber: userData.phoneNumber,\n                email: userData.email,\n            }\n        });\n\n        saveTokens(response.data.accessToken, response.data.refreshToken, response.data.expires);\n        \n        return response;\n    }\n    catch(error) {\n        return error.response;\n    }\n}\n\nexport async function login(userName, password) {\n    try {\n        const response = await axios({\n            method: 'post',\n            url: '/Auth/login',\n            data: {\n                userName: userName,\n                password: password\n            }\n        });\n\n        saveTokens(response.data.accessToken, response.data.refreshToken, response.data.expires);\n\n        return response;\n    }\n    catch(error) {\n        return error.response;\n    }\n}\n\nexport function logout() {\n    //const user = JSON.parse(localStorage.getItem('user'));\n\n    localStorage.removeItem('user');\n\n    /*const url = 'https://api.bo.aa44.ru/api/Auth/tokens/' + user.refreshToken + '/revoke';\n\n    try {\n        const response = await axios({\n            method: 'post',\n            url: url,\n            headers: {'Authorization': 'Bearer ' + user.accessToken}\n        });\n\n        return response;\n    }\n    catch(error) {\n        console.log(error);\n\n        return 0;\n    }*/\n}\n\nexport async function refreshToken() {\n    const token = JSON.parse(localStorage.getItem('user')).refreshToken;\n    const url = '/Auth/tokens/' + token + '/refresh';\n\n    try {\n        const response = await axios({\n            method: 'post',\n            url: url,\n        });\n\n        saveTokens(response.data.accessToken, response.data.refreshToken, response.data.expires);\n\n        return response;\n    }\n    catch(error) {\n        return false;\n    }\n}","import axios from 'axios'\n\nconst axiosConfig = axios.create({\n    baseURL: 'https://api.bo.aa44.ru/api',\n})\n\nexport default axiosConfig;","import { logout } from \"../../../services/auth/auth\";\nimport './logout.scss';\n\nexport default function Logout() {\n    return (\n        <div\n            className=\"logout\"\n            onClick={logout}>\n                \n            Выйти\n        </div>\n    );\n}\n","import './header.scss'\nimport Logout from '../../user/logout/logout.jsx';\n\nexport default function Header() {\n    const user = JSON.parse(localStorage.getItem('user'));\n\n    return (\n        <div className=\"header\">\n            <div></div>\n\n            <div>\n                {user && <Logout />}\n            </div>\n        </div>\n    )\n}","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","import arrayWithHoles from \"@babel/runtime/helpers/esm/arrayWithHoles\";\nimport iterableToArrayLimit from \"@babel/runtime/helpers/esm/iterableToArrayLimit\";\nimport unsupportedIterableToArray from \"@babel/runtime/helpers/esm/unsupportedIterableToArray\";\nimport nonIterableRest from \"@babel/runtime/helpers/esm/nonIterableRest\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","import arrayLikeToArray from \"@babel/runtime/helpers/esm/arrayLikeToArray\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import './modal.scss';\n\nexport default function Modal({isOpened, toggleModal, children}) {\n    return isOpened ? (\n        <div \n            className=\"modal__wrapper\"\n            onClick={() => toggleModal(false)}>\n\n            <div \n                className=\"modal\"\n                onClick={e => e.stopPropagation()}>\n\n                <span \n                    className=\"modal__close\"\n                    onClick={() => toggleModal(false)}>\n                    \n                    Закрыть\n                </span>\n\n               {children}\n            </div>\n        </div>\n    ) : false;\n}","import './country.scss';\nimport { useState } from 'react';\nimport Modal from '../../modal/modal';\n\nexport default function Country({countryData}) {\n    const [isModalOpened, toggleModal] = useState(false);\n\n    return (\n        <div className=\"country_wrapper\">\n            <div \n                className=\"country\"\n                onClick={() => toggleModal(true)}>\n\n                <div className=\"country__column\">{countryData.name}</div>\n                <div className=\"country__column\">{countryData.currency.currencyCode}</div>\n                <div className=\"country__column\">{countryData.currency.shortName}</div>\n            </div>\n\n            <Modal \n                isOpened={isModalOpened} \n                toggleModal={toggleModal}>\n\n                <div>{countryData.name}</div>\n                <div>{countryData.currency.currencyCode}</div>\n                <div>{countryData.currency.shortName}</div>\n            </Modal>\n        </div>  \n    );\n}","import axios from '../../axios-config.js'\n\nexport async function getCountriesFromApi() {\n    const user = JSON.parse(localStorage.getItem('user'));\n\n    if (!user) return false;\n\n    try {\n        const response = await axios({\n            method: 'get',\n            url: '/Countries',\n            headers: {'Authorization': 'Bearer ' + user.accessToken}\n        });\n    \n        return response;\n        //this.pages = Math.ceil(this.countries.count/this.perPage);\n    }\n    catch(error) {\n        return error.response;   \n    }\n}","import Country from '../country/country.jsx';\nimport { Redirect } from 'react-router-dom';\nimport { useState, useEffect } from 'react';\nimport { getCountriesFromApi } from '../../../services/countries/countries.js';\nimport './countries.scss';\nimport { logout, refreshToken } from '../../../services/auth/auth.js';\n\nexport default function Countries() {\n    const [countries, setCountries] = useState(null);\n    const [redirect, setRedirect] = useState(false);\n    const [loading, setLoadingStatus] = useState(true);\n    const [error, setError] = useState('');\n\n    useEffect(() => {\n        async function getCountries() {\n            let response = await getCountriesFromApi();\n            \n            if (clean) return false;    // если компонент уже unmounted\n\n            if (!response) {    //если пользователя вообще нет в localStorage\n                setRedirect(true);\n                return false;\n            }\n\n            if (response.status === 401) {  // если ошибка 401\n                if (await refreshToken()) { // пробуем рефреш \n                    response = await getCountriesFromApi(); // и снова получить страны, если рефреш удачный\n                }\n                else {\n                    logout();   // если рефреш неудачный, выкидываем пользователя из аккаунта\n                    setRedirect(true); \n\n                    return false;\n                }\n            }\n            \n            if (clean) return false; // если компонент уже unmounted после второго запроса стран\n\n            if (response.status === 200) // если все ок\n                setCountries(response.data);\n            else // пользователь точно авторизован, но список стран все равно получить не удается\n                setError('Произошла ошибка при загрузке данных. Повторите попытку позднее.')\n        \n            setLoadingStatus(false);\n        }\n\n        let clean = false;\n        getCountries();\n\n        return () => clean = true;\n\n    }, [countries])\n    \n    return loading ? (\n         <div>Загрузка</div>\n    ) : (\n        <div className=\"countries\">\n            <div className=\"countries__header\">\n                <div className=\"countries__column\">Name</div>\n                <div className=\"countries__column\">CurrencyCode</div>\n                <div className=\"countries__column\">ShortName</div>\n            </div>\n\n            {   \n                error\n                ? <div>{error}</div>\n                : countries.data.map(country => (\n                    <Country\n                        key={country.id}\n                        countryData={country} />\n                ))\n            }\n\n            {redirect && <Redirect to='/login' />}\n        </div>\n    );\n}","import Header from '../../components/basic/header/header.jsx';\nimport Countries from '../../components/countries/countries/countries.jsx';\nimport './home-page.scss';\n\nexport default function HomePage() {\n    return (\n       <div className=\"home-page\">\n           <Header />\n           <Countries />\n       </div>\n    )\n}"],"sourceRoot":""}